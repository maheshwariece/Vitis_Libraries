


<!DOCTYPE HTML>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
	<head>
		<meta charset="utf-8">
		<meta content="Vitis Database Library, GQE, join kernel, aggregate kernel, partition kernel" name="keywords" />
<meta content="GQE kernel design." name="description" />
<meta content="Document" name="xlnxdocumentclass" />
<meta content="Tutorials" name="xlnxdocumenttype" />

		<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
		<link rel="stylesheet" href="https://static.cloud.coveo.com/searchui/v2.4382/css/CoveoFullSearch.css"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta name="description"/>
		<meta name="keywords"/>
		<meta property="og:title" content=""/>
		<meta property="og:description"/>
		<!-- favicon -->
		<link rel="icon" type="image/vnd.microsoft.icon" href="../_static/favicon.ico"/>
		<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="../_static/favicon.ico"/>
		<!-- Fonts -->
		<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet" type="text/css"/>

  
  
  
  

  
      <script type="text/javascript" src="../_static/js/jquery.min.js"></script>
	  <script type="text/javascript" src="../_static/js/gtm.js"></script>
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
    <script type="text/javascript" src="../_static/js/d3dd8c60ed.js"></script>
    <script type="text/javascript" src="../_static/js/common-ui-all.min.js"></script>
    <script type="text/javascript" src="../_static/js/header-footer.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="../_static/js/CoveoJsSearch.Lazy.min.js"></script>
    <script type="text/javascript" src="../_static/js/linkid.js"></script>
    <script type="text/javascript" src="../_static/js/Searchbox.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/common-ui-all.min.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/header-footer.min.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/pro.min.css" media="all" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="GQE Kernel APIs" href="kernel_api.html" />
    <link rel="prev" title="L2 GQE Kernel User Guide" href="L2.html" /> 
	</head>
	<body>
		<div class="xilinx-bs3"/>
		<div class="root responsivegrid">
			<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 aem-Grid--large--16 aem-Grid--xlarge--16 aem-Grid--xxlarge--16 aem-Grid--xxxlarge--16 ">
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn aem-GridColumn--default--12">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="header parbase aem-GridColumn aem-GridColumn--default--12">
								<noindex>
									<header data-component="header">
										<nav class="navbar navbar-default aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid main-nav">
													<div class="row">
														<div class="col-xs-12">
															<div class="logo-column">
																<div class="logo">
																	<a href="https://www.xilinx.com/">
																	<img src="https://github.com/Xilinx/Image-Collateral/blob/main/xilinx-header-logo.svg?raw=true" title="Xilinx Inc"/>
																	</a>
																</div>
															</div>
															<div class="navbar-column">
																<div class="navbar navbar-collapse collapse" id="xilinx-main-menu">
																	<div class="mobile-search-container">
																		<div id="headerSearchBox" class="headerSearch"
																			data-component="header-search"
																			data-redirect-if-empty="false"
																			data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																			data-coveo-organization-id="xilinxcomprode2rjoqok">
																			<div class='coveo-search-section'>
																				<div class="CoveoAnalytics" data-search-hub="Site"></div>
																				<ul class="dropdown-menu options">
																					<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																						<a href="#">
																						All</a>
																					</li>
																					<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com//products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Silicon Devices</a>
																					</li>
																					<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com//products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Boards and Kits</a>
																					</li>
																					<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com//products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Intellectual Property</a>
																					</li>
																					<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																						<a href="#">
																						Support</a>
																						<ul>
																							<li data-label="Documentation" data-action-link="https://www.xilinx.com//support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																								<a href="#">
																								Documentation</a>
																							</li>
																							<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com//support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																								<a href="#">
																								Knowledge Base</a>
																							</li>
																							<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																								<a href="#">
																								Community Forums</a>
																							</li>
																						</ul>
																					</li>
																					<li data-label="Partners" data-action-link="https://www.xilinx.com//alliance/member-keyword-search.html" data-search-hub="Partner">
																						<a href="#">
																						Partners</a>
																					</li>
																					<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																						<a href="#">
																						Videos</a>
																					</li>
																					<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																						<a href="#">
																						Press</a>
																					</li>
																				</ul>
																				<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																				<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																			</div>
																		</div>
																	</div>
																	<ul class="nav navbar-nav nav-justified">
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/applications.html">
																			Applications</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/products/silicon-devices.html">
																			Products</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://developer.xilinx.com/">
																			Developers</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/support.html">
																			Support</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/about/company-overview.html">
																			About</a>
																		</li>
																	</ul>
																</div>
															</div>
															<script type="text/javascript" src="../_static/js/gtm.js"></script>
															<!--<div class="mini-nav">
																<button type="button" data-function="xilinx-mobile-menu" id="nav-toggle" class="navbar-toggle collapsed visible-xs-block" aria-expanded="false">
																<span></span>
																<span></span>
																<span></span>
																<span></span>
																</button>
																<ul class="list-inline">
																	<li class="dropdown user-menu">
																		<button data-toggle="dropdown">
																		<span class="sr-only">Account</span>
																		<span class="fas fa-user"></span>
																		</button>
																		<ul class="dropdown-menu">
																			<li>
																				<a href="https://www.xilinx.com/myprofile/subscriptions.html">
																				My Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/registration/create-account.html">
																				Create Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/bin/protected/en/signout">
																				Sign Out</a>
																			</li>
																		</ul>
																	</li>
																	<li class="hidden-xs">
																		<button data-function="search-toggle">
																		<span class="sr-only">Search</span>
																		<span class="far fa-search"></span>
																		</button>
																	</li>
																</ul>
															</div>
															-->
															<div class="search-container">
																<div id="headerSearchBox" class="headerSearch"
																	data-component="header-search"
																	data-redirect-if-empty="false"
																	data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																	data-coveo-organization-id="xilinxcomprode2rjoqok">
																	<div class='coveo-search-section'>
																		<div class="CoveoAnalytics" data-search-hub="Site"></div>
																		<ul class="dropdown-menu options">
																			<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																				<a href="#">
																				All</a>
																			</li>
																			<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com/products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Silicon Devices</a>
																			</li>
																			<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com/products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Boards and Kits</a>
																			</li>
																			<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com/products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Intellectual Property</a>
																			</li>
																			<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																				<a href="#">
																				Support</a>
																				<ul>
																					<li data-label="Documentation" data-action-link="https://www.xilinx.com/support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																						<a href="#">
																						Documentation</a>
																					</li>
																					<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com/support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																						<a href="#">
																						Knowledge Base</a>
																					</li>
																					<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																						<a href="#">
																						Community Forums</a>
																					</li>
																				</ul>
																			</li>
																			<li data-label="Partners" data-action-link="https://www.xilinx.com/alliance/member-keyword-search.html" data-search-hub="Partner">
																				<a href="#">
																				Partners</a>
																			</li>
																			<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																				<a href="#">
																				Videos</a>
																			</li>
																			<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																				<a href="#">
																				Press</a>
																			</li>
																		</ul>
																		<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																		<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																	</div>
																</div>
																<button data-function="search-toggle">
																<span class="sr-only">Search</span>
																<span class="far fa-times"></span>
																</button>
															</div>
														</div>
													</div>
												</div>
											</div>
										</nav>
									</header>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="parsys aem-GridColumn--xxxlarge--none aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
						<div class="container-fluid">
							<div class="row">
							<div class="col-xs-12">
   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Vitis Database Library
          

          
          </a>

          
            
            
              <div class="version">
                2021.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

      
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
            
            
            
              
            
            
              <p class="caption"><span class="caption-text">Library Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Vitis Database Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release.html">Release Note</a></li>
<li class="toctree-l1"><a class="reference internal" href="../requirements.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design_flows.html">Design Flows</a></li>
</ul>
<p class="caption"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../guide/L1.html">L1 Module User Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="L2.html">L2 GQE Kernel User Guide</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">GQE Kernel Design</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#join-kernel">Join Kernel</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bloom-filter-kernel">Bloom-Filter Kernel</a></li>
<li class="toctree-l3"><a class="reference internal" href="#aggregate-kernel">Aggregate Kernel</a></li>
<li class="toctree-l3"><a class="reference internal" href="#partition-kernel">Partition Kernel</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="kernel_api.html">GQE Kernel APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernel_config.html">GQE Kernel Configuration APIs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="L3.html">L3 GQE Overlay User Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Benchmark Result</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../benchmark.html">Benchmark</a></li>
<li class="toctree-l1"><a class="reference internal" href="../benchmark/tpc_h.html">TPC-H Queries with GQE</a></li>
</ul>

            
			
				<h3>Versions</h3>
				<ul>
				  <li><a href=""></a></li>
				  <li><a href=""></a></li>
				  <li><a href=""></a></li>
				  <li><a href=""></a></li>
				</ul>
			
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Vitis Database Library</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="L2.html">L2 GQE Kernel User Guide</a> &raquo;</li>
        
      <li>GQE Kernel Design</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="gqe-kernel-design">
<span id="id1"></span><h1>GQE Kernel Design<a class="headerlink" href="#gqe-kernel-design" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<div class="admonition caution" id="gqe-join-kernel-design">
<p class="first admonition-title">Caution</p>
<p class="last">There is <em>NO</em> long-term-support to current version GQE kernels. The kernel APIs are subject to be changed for practicality in the comimg release.</p>
</div>
<div class="section" id="join-kernel">
<h2>Join Kernel<a class="headerlink" href="#join-kernel" title="Permalink to this headline">¶</a></h2>
<p id="gqe-join-kernel">The GQE join kernel is a compound of multiple post-bitstream programmable primitives,
and can execute not only hash-join but also a number of primitives often found as
prologue or epilogue of join operations. With its bypass design in data path,
it can even perform execution without a join.</p>
<a class="reference internal image-reference" href="../_images/hashjoin_bp_structure.png"><img alt="GQE Join Kernel" class="align-center" src="../_images/hashjoin_bp_structure.png" style="width: 800.0px; height: 287.2px;" /></a>
<p>The internal of this kernel is illustrated in the figure above. Internal multi-join supports
three reconfigurable modes, namely inner join, anti-join and semi-join. To join efficiently at different data scale, the join process is divided into two phases: build and probe. Build phase takes Table A as input to build the hash table, while Probe phase takes Table B as input and probes the conflicting rows from built hash table. By calling Table B multiple iterations, any sized Table B can be joined. On the other hand, By spliting Table A into multiple slice and running mutli-(build + Nx probe), Table A with any size can be employed as the left table.</p>
<p>This kernel works with three types of input buffers, 1x kernel configuration buffer, 1x meta info buffer and 3x column data buffers. The result buffers are 1x result data meta and 4x output column data.</p>
<p>The input / output data columns save all raw column data. The statistic information, e.g., row number, column number, is recorded in meta input / output buffer. The internal structure of meta info is shown in the figure below. The first 4 rows are valid for Join kernel. Each row represents the info of one data column.</p>
<a class="reference internal image-reference" href="../_images/meta_layout.png"><img alt="meta info layout" class="align-center" src="../_images/meta_layout.png" style="width: 1322.0px; height: 588.0px;" /></a>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>gqePart kernel supports maximum 256 partitions, each partition nrow is 32-bit, starting from meta[8], 256 / 16 = 16 lines are used for partitioning nrow output.</li>
<li>When the partition num is less than 256, using the first N parts, starting from meta[8][31-0]</li>
</ul>
</div>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p class="last">In the current release, all columns are expected to have the same number of elements of same type.</p>
</div>
<p>The configuration buffer basically programs the kernel at runtime. It toggles execution step
primitives on or off, and defines the filter and/or evaluation expressions.
The details are documented in the following figure:</p>
<a class="reference internal image-reference" href="../_images/kernelcmd.png"><img alt="kernel command info layout" class="align-center" src="../_images/kernelcmd.png" style="width: 1500.0px; height: 910.0px;" /></a>
<p>14 lines of 512-bit configure data are used in kernel command. Address 0x00 is join only config, 0x01 for partition kernel, 0x02 for bloomfilter kernel, and 0x03-0x05 is reserved for gqeAggr kernel. Since the filtering module is the same in all kernels, same configuration lines 0x06 - 0x13 are used.</p>
<p>Both input table A and B can support up to 3 columns, which may consist of 1-2 key columns and 1 payload columns. The col enable flags are set in bit 6-11. The output column enable flags are 12-15 bits.</p>
<p>Payload column data, which is normally used as rowID column, can be read from user input or auto-generating in kernel. The rowID generation config is controled by bit16/18. If generating rowID inside the kernel, the validation enable flag also must be configured to determin whether to use the validation buffer.</p>
<p>The columns are indexed starting from 0.  <code class="docutils literal notranslate"><span class="pre">-1</span></code> is used as a special value to instruct the table scanner to feed zero for that column.</p>
<p>Current kernel join kernel can be configured to join mode or bloomfilter mode, which is controlled by bit 1.</p>
<p>The filter config is aligned to lower bits. Build/probe table’s filter config are located in addr 0x06-0x09 / 0x10-0x13.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">join_on</span></code> option toggles whether hash-join is enabled or by-passed in the pipeline.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">dual_key</span></code> option instructs the kernel to use both first and second column as join key in hash-join, and when it is asserted, the third column
becomes the first part of the payload input.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">join</span> <span class="pre">sel</span></code> option indicates the work mode of multi-join, 0 for normal hash join, 1 for semi-join and 2 for anti-join.</p>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p class="last">The 3-columns input data are scanned in via 3x 256-bit AXI ports. However, only 1x 512-bit AXI port is employed to output (up <a href="#id2"><span class="problematic" id="id3">to_</span></a> 4 cols data. When the resulting data are huge, the write out module performance would decrease the kernel performance.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Directly bypass is supported by configuring the join kernel to probe mode. Then the kernel works as a filtering kernel. All data will go through the “channel merge” path in the kernel structure figure shown on the top.</p>
</div>
<p>The hardware resource utilization of join kernel is shown in the table below (work at 180MHz).</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="10%" />
<col width="22%" />
<col width="15%" />
<col width="12%" />
<col width="9%" />
<col width="7%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Module</td>
<td>LUT</td>
<td>LUT as memory</td>
<td>Register</td>
<td>BRAM36</td>
<td>URAM</td>
<td>DSP</td>
</tr>
<tr class="row-even"><td>AXI adapters</td>
<td>53546</td>
<td>23316</td>
<td>79997</td>
<td>156.5</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="row-odd"><td>Scan</td>
<td>8402</td>
<td>931</td>
<td>10032</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="row-even"><td>Filter</td>
<td>20496</td>
<td>3936</td>
<td>12629</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="row-odd"><td>crossbar 4-to-8</td>
<td>7166</td>
<td>729</td>
<td>11653</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="row-even"><td>join (BF)</td>
<td>12375</td>
<td>2659</td>
<td>15272</td>
<td>9.5</td>
<td>24</td>
<td>12</td>
</tr>
<tr class="row-odd"><td>collect 8-to-1</td>
<td>608</td>
<td>0</td>
<td>2110</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="row-even"><td>Write</td>
<td>7687</td>
<td>8</td>
<td>6738</td>
<td>30</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="row-odd"><td>Total</td>
<td>110280</td>
<td>31579</td>
<td>138431</td>
<td>197</td>
<td>24</td>
<td>12</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="bloom-filter-kernel">
<h2>Bloom-Filter Kernel<a class="headerlink" href="#bloom-filter-kernel" title="Permalink to this headline">¶</a></h2>
<p>The bloom-filter is a space-efficient probabilistic data structure that is used to test whether an element is a member of a set. False positive matches are possible, but false negatives are not - in other words, a query returns either “possibly in set” or “definitely not in set”. (from Wikipedia)</p>
<p>The GQE Bloom-Filter kernel is an HLS kernel implementation that fully utilizes the high bandwidth feature of HBM to accelerate the query (probe-only) ability and expands the capacity as large as possible at the same time.</p>
<p>The GQE Bloom-Filter kernel also shares the same framework as GQE Join. Thus, the input key and payload should be 64-bit width, and 1 or 2 key column(s) plus 1 playoad column is allowed to be applied to the kernel. In addition, the bloom-filter and join functionality selection is controlled by kernel command bit <code class="docutils literal notranslate"><span class="pre">config[0][1]</span></code>, where bloom-filter is enabled by setting the corresponding bit to <strong>1</strong>.</p>
<p>The structure of the gqeJoin (bloom-filter) can be shown as the following figure:</p>
<a class="reference internal image-reference" href="../_images/join_bloomfilter_structure.png"><img alt="GQE Join (BF) Kernel" class="align-center" src="../_images/join_bloomfilter_structure.png" style="width: 921.6px; height: 518.4px;" /></a>
<p>As the main usage of the GQE kernel is already covered in <a class="reference internal" href="#gqe-join-kernel"><span class="std std-ref">GQE Join kernel design</span></a>. We’ll only introduce the specifications for input and output columns of GQE for using bloom-filter flow here.</p>
<p>The columns for using the bloom-filter flow can be explained as:</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="14%" />
<col width="75%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td rowspan="3">Input</td>
<td>Column 0</td>
<td>key 0</td>
</tr>
<tr class="row-even"><td>Column 1</td>
<td>key 1 (if dual-key is enabled)</td>
</tr>
<tr class="row-odd"><td>Column 2</td>
<td>payload</td>
</tr>
<tr class="row-even"><td rowspan="4">Output</td>
<td>Column 0</td>
<td>payload</td>
</tr>
<tr class="row-odd"><td>Column 1</td>
<td>unused (no additional payload in bloom-filter flow)</td>
</tr>
<tr class="row-even"><td>Column 2</td>
<td>key 0</td>
</tr>
<tr class="row-odd"><td>Column 3</td>
<td>key 1 (if dual-key is enabled)</td>
</tr>
</tbody>
</table>
<p>Software developer who wants to benefit from the hardware acceleration for bloom-filtering, please kindly refer to the <a class="reference internal" href="gqe_l3_design.html#bloomfilter-l3-usage"><span class="std std-ref">Example Usage</span></a> in L3 documentation.</p>
</div>
<div class="section" id="aggregate-kernel">
<h2>Aggregate Kernel<a class="headerlink" href="#aggregate-kernel" title="Permalink to this headline">¶</a></h2>
<p>The Aggregate kernel is another key kernel of General Query Engine (GQE) which supports both grouping and non-grouping aggregate operations.</p>
<a class="reference internal image-reference" href="../_images/gqe_aggr_kernel.png"><img alt="GQE Aggregate Kernel" class="align-center" src="../_images/gqe_aggr_kernel.png" style="width: 801.6px; height: 348.0px;" /></a>
<p>The internal structure of this kernel is shown in the figure above. Same to join kernel, 8-cols data buffer, 1x kernel config buffer and 1x meta info buffer are employecd as the kernel input. Due to the diversity of output data types, e.g., aggregate max, min, raw data, etc., 16x output column buffers are used as the output buffer. As shown in above figure, before entering into hash group aggregate module, each element in each
row will be evaluated and filtered. Thus, some new elements can be generated and some rows will be
discarded. Moreover, two cascaded evaluation modules are added to support more complex expression.</p>
<p>The core module of aggregate kernel is hash group aggregate, which is a multi-PU implementation and given
in the following diagram. Each PU requires 2 HBM banks and some URAM memory blocks to buffer distinct
keys as well as payloads after aggregate operations. And one internal loop is implemented to consume
all input rows with each iteration. Furthermore, all PUs are working in parallel to achieve higher
performance.</p>
<a class="reference internal image-reference" href="../_images/gqe_aggr_detail.png"><img alt="Detais Diagram of Hash Group Aggregate" class="align-center" src="../_images/gqe_aggr_detail.png" style="width: 665.4px; height: 421.8px;" /></a>
<p>The data structure of input and output meta and raw data are same as join kernel. The configuration buffer is composed of 128x 32-bit slots. The details of configuration buffers are listed in the table:</p>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="37%" />
<col width="41%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Module</td>
<td>Module Config Width</td>
<td>Position</td>
</tr>
<tr class="row-even"><td>Scan</td>
<td>64 bit</td>
<td>config[0]~config[1]</td>
</tr>
<tr class="row-odd"><td>Eval0</td>
<td>289 bit</td>
<td>config[2]~config[11]</td>
</tr>
<tr class="row-even"><td>Eval1</td>
<td>289 bit</td>
<td>config[12]~config[21]</td>
</tr>
<tr class="row-odd"><td>Filter</td>
<td>45*32 bit</td>
<td>config[22]~config[66]</td>
</tr>
<tr class="row-even"><td>Shuffle0</td>
<td>64 bit</td>
<td>config[67]~config[68]</td>
</tr>
<tr class="row-odd"><td>Shuffle1</td>
<td>64 bit</td>
<td>config[69]~config[70]</td>
</tr>
<tr class="row-even"><td>Shuffle2</td>
<td>64 bit</td>
<td>config[71]~config[72]</td>
</tr>
<tr class="row-odd"><td>Shuffle3</td>
<td>64 bit</td>
<td>config[73]~config[74]</td>
</tr>
<tr class="row-even"><td>Group Aggr</td>
<td>4*32 bit</td>
<td>config[75]~config[78]</td>
</tr>
<tr class="row-odd"><td>Column Merge</td>
<td>64 bit</td>
<td>config[79]~config[80]</td>
</tr>
<tr class="row-even"><td>Aggregate</td>
<td>1 bit</td>
<td>config[81]</td>
</tr>
<tr class="row-odd"><td>Write</td>
<td>16 bit</td>
<td>config[82]</td>
</tr>
<tr class="row-even"><td>Reserved</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td>config[83]~config[127]</td>
</tr>
</tbody>
</table>
<p>The hardware resource utilization of hash group aggregate is shown in the table below (work as 180MHz).</p>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="11%" />
<col width="8%" />
<col width="16%" />
<col width="15%" />
<col width="11%" />
<col width="9%" />
<col width="7%" />
<col width="5%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Primitive</td>
<td>Quantity</td>
<td>LUT</td>
<td>LUT as memory</td>
<td>LUT as logic</td>
<td>Register</td>
<td>BRAM36</td>
<td>URAM</td>
<td>DSP</td>
</tr>
<tr class="row-even"><td>Scan</td>
<td>1</td>
<td>12209</td>
<td>4758</td>
<td>7451</td>
<td>18974</td>
<td>0</td>
<td>0</td>
<td>2</td>
</tr>
<tr class="row-odd"><td>Eval</td>
<td>8</td>
<td>2153</td>
<td>426</td>
<td>1727</td>
<td>2042</td>
<td>4</td>
<td>0</td>
<td>21</td>
</tr>
<tr class="row-even"><td>Filter</td>
<td>4</td>
<td>2168</td>
<td>13</td>
<td>2155</td>
<td>1764</td>
<td>0.5</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="row-odd"><td>Group Aggr</td>
<td>1</td>
<td>162202</td>
<td>27819</td>
<td>134383</td>
<td>210926</td>
<td>62</td>
<td>256</td>
<td>0</td>
</tr>
<tr class="row-even"><td>Direct Aggr</td>
<td>1</td>
<td>4349</td>
<td>0</td>
<td>4349</td>
<td>6611</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="row-odd"><td>Write</td>
<td>1</td>
<td>30938</td>
<td>9490</td>
<td>21448</td>
<td>43579</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="row-even"><td>AXI DDR</td>
<td>1</td>
<td>4586</td>
<td>1313</td>
<td>3273</td>
<td>78855</td>
<td>18</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="row-odd"><td>AXI HBM</td>
<td>1</td>
<td>20528</td>
<td>4456</td>
<td>16072</td>
<td>45416</td>
<td>124</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="row-even"><td>Total</td>
<td>&#160;</td>
<td>298470</td>
<td>60402</td>
<td>238068</td>
<td>399737</td>
<td>255</td>
<td>256</td>
<td>2</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="partition-kernel">
<h2>Partition Kernel<a class="headerlink" href="#partition-kernel" title="Permalink to this headline">¶</a></h2>
<p>The GQE partition kernel can partition one table’s rows into corresponding clusters according to hash of selected
key columns. This kernel is designed to scale the problem size that can be handled by the GQE Join or Aggregate kernel.
To reduce the size of intermediate data, it is equipped with dynamic filter like other kernels.</p>
<a class="reference internal image-reference" href="../_images/partition_kernel_structure.png"><img alt="GQE Part Kernel" class="align-center" src="../_images/partition_kernel_structure.png" style="width: 1008.8000000000001px; height: 382.40000000000003px;" /></a>
<p>The internal of this kernel is illustrated in the figure above. It scans kernel config buffer, metainfo buffer and 8x cols input raw data in and passes to a filter. The filter condition is configured in kernel config buffer. After filtering, each row data will be dispatched into one of 4 PUs to calculate hash value of the primary key. Based on the hash value, the key and payload data are saved to the accroding bucket / partition. Once one bucket is full, the full bucket will trigger one time burst write which writes data from bucket to resulting buffer.</p>
<p>In the kernel structure, URAM array that connected to “build PU” is drawn. Here maximum 256 buckets are created in URAM array, each bucket saves one time burst write to resulting buffer. The output of partition kernel is 8x cols output data and 1x meta info buffer.</p>
<p>To simplify the design, GQE partition kernel can reuse the scan and filter configuration with GQE join kernel. Also, as mentioned above, the data structure of input and output tables is the same as join kernel.</p>
<p>The hardware resource utilization of single hash partition is shown in the table below (work as 200MHz).</p>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="9%" />
<col width="19%" />
<col width="17%" />
<col width="12%" />
<col width="10%" />
<col width="7%" />
<col width="6%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Primitive</td>
<td>LUT</td>
<td>LUT as memory</td>
<td>LUT as logic</td>
<td>Register</td>
<td>BRAM36</td>
<td>URAM</td>
<td>DSP</td>
</tr>
<tr class="row-even"><td>Scan</td>
<td>17109</td>
<td>5400</td>
<td>11709</td>
<td>20538</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="row-odd"><td>Filter</td>
<td>12853</td>
<td>3300</td>
<td>9553</td>
<td>8106</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="row-even"><td>Hash partition</td>
<td>64336</td>
<td>5424</td>
<td>59912</td>
<td>50573</td>
<td>122</td>
<td>208</td>
<td>20</td>
</tr>
<tr class="row-odd"><td>Write</td>
<td>22385</td>
<td>5082</td>
<td>4816</td>
<td>29608</td>
<td>9</td>
<td>0</td>
<td>3</td>
</tr>
<tr class="row-even"><td>AXI DDR</td>
<td>37917</td>
<td>3461</td>
<td>34456</td>
<td>42380</td>
<td>51</td>
<td>0</td>
<td>6</td>
</tr>
<tr class="row-odd"><td>Total</td>
<td>134818</td>
<td>26553</td>
<td>108220</td>
<td>116884</td>
<td>240</td>
<td>256</td>
<td>29</td>
</tr>
</tbody>
</table>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">For gqeJoin and gqeAggr kernel, only first 8 rows are valid. However, all 24 rows are valid in gqePart kernel. The row number of each output partition is given in the output meta, from row 8 to 23. Due to the supported maximum partition number is 256, each row number takes 32 bit in meta buffer, 256/(512/32) = 16 lines are employed to save these row number info.
Besides, The partition size should be provided for gqePart input meta.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
<!-- Atalwar: Moved the footer code to layout.html to resolve conflict with the Xilinx template -->
</footer>

        </div>
      </div>


	  <!-- Sphinx Page Footer block -->
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="kernel_api.html" class="btn btn-neutral float-right" title="GQE Kernel APIs" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="L2.html" class="btn btn-neutral float-left" title="L2 GQE Kernel User Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo" class="copyright">
    <p class="footerinfo">
      <span class="lastupdated">
        Last updated on June 09, 2021.
      </span>

    </p>
	<br>
  </div>
      </div>
    </section>


  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

   <script type="text/javascript">
    jQuery(function() { Search.loadIndex("searchindex.js"); });
  </script>

  <script type="text/javascript" id="searchindexloader"></script>


  
  
    
  



  <!--  Xilinx template footer block -->
							</div>
						</div>
					</div>
				</div>
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="footer parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
								<noindex>
                  <!-- make footer fixed - NileshP -->
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
                  <!-- make footer fixed NileshP-->
									<footer>
										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">
													<div class="row">
														<div class="footerSocial parbase">
															<div class="col-md-push-6 col-lg-push-6 col-md-6 col-lg-6">
																<ul class="list-inline pull-right social-menu">
																	<li>
																		<a href="https://www.linkedin.com/company/xilinx">
																		<span class="linkedin icon"></span>
																		<span class="sr-only">Connect on LinkedIn</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.twitter.com/XilinxInc">
																		<span class="twitter icon"></span>
																		<span class="sr-only">Follow us on Twitter</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.facebook.com/XilinxInc">
																		<span class="facebook icon"></span>
																		<span class="sr-only">Connect on Facebook</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.youtube.com/XilinxInc">
																		<span class="youtube icon"></span>
																		<span class="sr-only">Watch us on YouTube</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.xilinx.com/registration/subscriber-signup.html">
																		<span class="newsletter icon"></span>
																		<span class="sr-only">Subscribe to Newsletter</span>
																		</a>
																	</li>
																</ul>
															</div>
														</div>
														<div class="col-md-pull-6 col-lg-pull-6 col-md-6 col-lg-6">
															<span class="copyright">
                                  
                                  &copy; 2021, Xilinx
                              </span>
															<ul class="list-inline sub-menu">
																<li>
																	<a href="https://www.xilinx.com/about/privacy-policy.html">Privacy</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/legal.html">Legal</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/contact.html">Contact</a>
																</li>
															</ul>
														</div>
													</div>
												</div>
											</div>
										</div>
									</footer>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="quicklinks parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<noindex>
						<span class="quickLinks">
							<ul>
								<li>
									<a href="#top" class="btn backToTop">
									<span class="fas fa-angle-up" aria-hidden="true"></span>
									</a>
								</li>
							</ul>
						</span>
					</noindex>
				</div>
			</div>
		</div>
		<script>window.CQ = window.CQ || {}</script>
		<script src="https://static.cloud.coveo.com/searchui/v2.4382/js/CoveoJsSearch.Lazy.min.js"></script>
		<script>
			var underscoreSetup = function () {
			  _.templateSettings.interpolate = /\{\{=([^-][\S\s]+?)\}\}/g;
			  _.templateSettings.evaluate = /\{\{([^-=][\S\s]+?)\}\}/g;
			  _.templateSettings.escape = /\{\{-([^=][\S\s]+?)\}\}/g;
			}

			underscoreSetup();
		</script>
	</body>
</html>